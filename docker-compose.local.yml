version: "3.4"

services:

  consul:
    image: consul


  ### mail #############################################
  mail:
    image: educonn/mail:latest
    environment:
      DEBUG: 1
      MICRO_REGISTRY: "consul"
      MICRO_REGISTRY_ADDRESS: "consul"
      SMTP_HOST: "smtp.mailtrap.io"
      SMTP_PORT: 2525
      SMTP_USERNAME: "0f92ba981e4a2f"
      SMTP_PASSWORD: "09f0dcb79f8f24"
    depends_on:
      - consul

  ### mail-cli ########################################
  mail-cli:
    image: educonn/mail-cli:latest
    environment:
      MICRO_REGISTRY: "consul"
      MICRO_REGISTRY_ADDRESS: "consul"
    depends_on:
      - mail


  ### user ###########################################
  user:
    image: educonn/user:latest
    environment:
      MICRO_REGISTRY: "consul"
      MICRO_REGISTRY_ADDRESS: "consul"
      DEBUG: 1
      DB_HOST: "user-db"
      DB_NAME: "users"
      DB_USERNAME:  "users"
      DB_PASSWORD:  "secret"
      DB_PORT: "3306"
    depends_on:
      - user-db

  ### user-db ########################################
  user-db:
    image: mysql:5.7
    environment:
      MYSQL_USER: "users"
      MYSQL_PASSWORD: "secret"
      MYSQL_DATABASE: "users"
      MYSQL_ROOT_PASSWORD: "superSecret"
    ports:
      - 3306:3306
